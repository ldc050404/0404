<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enchant Simulator</title>

<link rel="icon" type="image/png" href="0001.png">

<style>
body {
  margin: 0;
  padding: 0;
  background: #ffffff;
  font-family: 'Pretendard', sans-serif;
}

/* ===== ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ===== */
.top-nav {
  width: 100%;
  height: 80px;
  display: flex;
  align-items: center;
  gap: 20px;
  padding-left: 30px;
  border-bottom: 1px solid #e5e5e5;
}

.top-nav img {
  width: 64px;
  height: 64px;
  cursor: pointer;
}

.top-nav-title {
  font-size: 26px;
  font-weight: 700;
  color: #222;
}

/* ===== ì „ì²´ ë ˆì´ì•„ì›ƒ ===== */
.container {
  display: flex;
  width: 100%;
  height: calc(100vh - 80px);
}

/* ===== ì¢Œì¸¡ ì¥ë¹„ ì„ íƒ íŒ¨ë„ ===== */
.left-panel {
  width: 240px;
  padding: 20px;
  border-right: 1px solid #e5e5e5;
  overflow-y: auto;
}

.left-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 15px;
}

.equip-btn {
  width: 100%;
  padding: 12px 14px;
  border-radius: 12px;
  background: #f5f5f5;
  border: 1px solid #ddd;
  font-size: 15px;
  margin-bottom: 10px;
  cursor: pointer;
  text-align: left;
  transition: 0.15s ease-in-out;
}

.equip-btn:hover {
  background: #ebebeb;
}

.equip-btn.active {
  border: 2px solid #2fb24a;
  background: #eaffea;
}

/* ===== ì¤‘ì•™ ìŠ¬ë¡¯ ì˜ì—­ ===== */
.center-panel {
  flex: 1;
  padding: 30px 40px;
  overflow-y: auto;
}

.center-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 20px;
}

.slots-box {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 14px;
  max-width: 600px;
}

.slot {
  width: 110px;
  height: 110px;
  border: 2px dashed #bbb;
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 13px;
  color: #888;
  cursor: pointer;
  position: relative;
  transition: 0.2s ease;
}

.slot:hover {
  background: #fafafa;
}

.slot-filled {
  border: 2px solid #2fb24a !important;
  background: #f8fff8;
}

/* ìŠ¬ë¡¯ ë‚´ë¶€ ì¸ì±ˆíŠ¸ ì¹´ë“œ */
.slot-enchant {
  position: absolute;
  top: 8px;
  left: 8px;
  right: 8px;
  bottom: 8px;
  background: white;
  border-radius: 10px;
  border: 1px solid #ccc;
  padding: 10px;
  font-size: 13px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}

/* ì œê±° ë²„íŠ¼ */
.remove-btn {
  position: absolute;
  top: -6px;
  right: -6px;
  background: #ff6767;
  color: white;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  font-size: 14px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}

/* ===== ì˜¤ë¥¸ìª½ ì¸ì±ˆíŠ¸ ëª©ë¡ ===== */
.right-panel {
  width: 420px;
  border-left: 1px solid #e5e5e5;
  padding: 20px;
  overflow-y: auto;
}

.right-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 10px;
}

.search-box {
  width: 100%;
  padding: 12px 16px;
  font-size: 15px;
  border: 1px solid #ddd;
  border-radius: 10px;
  margin-bottom: 14px;
}

/* ì¸ì±ˆíŠ¸ ì¹´ë“œ */
.enchant-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #ddd;
  background: #fff;
  margin-bottom: 12px;
  cursor: pointer;
  transition: 0.15s ease-in-out;
}

.enchant-card:hover {
  background: #f5f5f5;
}

.enchant-icon {
  width: 40px;
  height: 40px;
}

/* ì €ì¥ / ë¶ˆëŸ¬ì˜¤ê¸° */
.save-box {
  margin-top: 20px;
  border-top: 1px solid #ddd;
  padding-top: 20px;
}

.save-btn {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  background: #2fb24a;
  color: white;
  border: none;
  font-size: 15px;
  cursor: pointer;
  margin-bottom: 10px;
}

.load-btn {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  background: #f3f3f3;
  color: #333;
  border: 1px solid #ccc;
  font-size: 15px;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- ===== ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ===== -->
<div class="top-nav">
  <a href="index.html">
    <img src="0003.png">
  </a>
  <div class="top-nav-title">Enchantment Simulator</div>
</div>

<div class="container">

  <!-- ===== ì¢Œì¸¡ ì¥ë¹„ ì„ íƒ ì˜ì—­ ===== -->
  <div class="left-panel">
    <div class="left-title">ì¥ë¹„ ì„ íƒ</div>

    <button class="equip-btn" data-equip="ê²€">âš” ê²€</button>
    <button class="equip-btn" data-equip="í™œ">ğŸ¹ í™œ</button>
    <button class="equip-btn" data-equip="ì‡ ë‡Œ">ğŸ¹ ì‡ ë‡Œ</button>
    <button class="equip-btn" data-equip="ì‚¼ì§€ì°½">ğŸ”± ì‚¼ì§€ì°½</button>
    <button class="equip-btn" data-equip="ë„ë¼">ğŸª“ ë„ë¼</button>
    <button class="equip-btn" data-equip="ì‚½">â› ì‚½</button>
    <button class="equip-btn" data-equip="ê´­ì´">ğŸª  ê´­ì´</button>
    <button class="equip-btn" data-equip="ëª¨ì">ğŸ© ëª¨ì</button>
    <button class="equip-btn" data-equip="í‰ê°‘">ğŸ¥‹ í‰ê°‘</button>
    <button class="equip-btn" data-equip="ë°”ì§€">ğŸ‘– ë°”ì§€</button>
    <button class="equip-btn" data-equip="ì‹ ë°œ">ğŸ‘Ÿ ì‹ ë°œ</button>
  </div>

  <!-- ===== ì¤‘ì•™ ìŠ¬ë¡¯ ì˜ì—­ ===== -->
  <div class="center-panel">
    <div class="center-title">ì¸ì±ˆíŠ¸ ìŠ¬ë¡¯ (ìµœëŒ€ 10ê°œ)</div>

    <div class="slots-box" id="slotsBox">
      <!-- JSì—ì„œ ìŠ¬ë¡¯ 10ê°œ ìƒì„± -->
    </div>
  </div>

  <!-- ===== ì˜¤ë¥¸ìª½ ì¸ì±ˆíŠ¸ ëª©ë¡ ===== -->
  <div class="right-panel">
    <div class="right-title">ì¸ì±ˆíŠ¸ ëª©ë¡</div>

    <input type="text" class="search-box" id="searchEnchant" placeholder="ì¸ì±ˆíŠ¸ ê²€ìƒ‰">

    <div id="enchantList"></div>

    <div class="save-box">
      <button class="save-btn" id="saveBuild">ì €ì¥í•˜ê¸°</button>
      <button class="load-btn" id="loadBuild">ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
  </div>

</div>

<!-- ë’¤ì—ì„œ PART 2/4 ì—ì„œ JS ì¶”ê°€ë¨ -->
<script>
</script>

</body>
</html>
<script>
// =============================================
// 0. ì „ì—­ ë³€ìˆ˜
// =============================================
let CURRENT_EQUIP = null;            // í˜„ì¬ ì„ íƒì¤‘ì¸ ì¥ë¹„
let SLOT_DATA = Array(10).fill(null); // 10ê°œ ìŠ¬ë¡¯ ë°ì´í„° êµ¬ì¡°
let ENCHANT_DATA = [];               // ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¨ ì „ì²´ ì¸ì±ˆíŠ¸
let SAVE_SLOTS = [];                 // ì €ì¥ëœ ì„¸íŠ¸ë“¤

// =============================================
// 1. ìŠ¬ë¡¯ 10ê°œ ìë™ ìƒì„±
// =============================================
const slotBox = document.getElementById("slotsBox");

for (let i = 0; i < 10; i++) {
  const slot = document.createElement("div");
  slot.className = "slot";
  slot.dataset.index = i;
  slot.innerHTML = "+";

  // ìŠ¬ë¡¯ í´ë¦­ â†’ ë¹„ì›Œì§„ ìƒíƒœë¼ë©´ ë¬´ì‹œ (ì¸ì±ˆíŠ¸ëŠ” ì˜¤ë¥¸ìª½ ì¹´ë“œ í´ë¦­ìœ¼ë¡œë§Œ ì¥ì°©)
  slot.onclick = () => {
    if (!SLOT_DATA[i]) return;
  };

  slotBox.appendChild(slot);
}

// =============================================
// 2. ì¥ë¹„ ì„ íƒ ë²„íŠ¼
// =============================================
document.querySelectorAll(".equip-btn").forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".equip-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    CURRENT_EQUIP = btn.dataset.equip;

    // ì¥ë¹„ ì„ íƒ ì‹œ ì¸ì±ˆíŠ¸ ëª©ë¡ í•„í„°ë§
    renderEnchantList();
  };
});

// =============================================
// 3. Google Sheet ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
// =============================================
const SHEET_ID = "13fF_iQfMThiw49QrYSCULF3mT4QVHO4aDsbSDD71DUg";
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

fetch(SHEET_URL)
  .then(res => res.text())
  .then(txt => {
    const json = JSON.parse(txt.substr(47).slice(0, -2));
    ENCHANT_DATA = json.table.rows.map(r => ({
      name: r.c[0]?.v ?? "",
      grade: r.c[1]?.v ?? "",
      tier: r.c[2]?.v ?? "",
      max: r.c[3]?.v ?? "",
      items: (r.c[4]?.v ?? "").split(",").map(i => i.trim()),
      effect: r.c[5]?.v ?? "",
      extra: r.c[6]?.v ?? ""
    }));

    renderEnchantList();
  });

// =============================================
// 4. ì¸ì±ˆíŠ¸ ëª©ë¡ ë Œë”ë§ (ì¥ë¹„ í•„í„°ë§ ì ìš©)
// =============================================
function renderEnchantList() {
  const box = document.getElementById("enchantList");
  box.innerHTML = "";

  let list = [...ENCHANT_DATA];

  // ì¥ë¹„ ì„ íƒ í•„í„° ì ìš©
  if (CURRENT_EQUIP) {
    list = list.filter(e => e.items.includes(CURRENT_EQUIP));
  }

  // ê²€ìƒ‰ í•„í„°
  const keyword = document.getElementById("searchEnchant").value.trim();
  if (keyword) {
    list = list.filter(e => e.name.includes(keyword));
  }

  // ì¹´ë“œ ë Œë”ë§
  list.forEach(e => {
    const card = document.createElement("div");
    card.className = "enchant-card";

    card.innerHTML = `
      <img src="0003.png" class="enchant-icon">
      <div>
        <div style="font-weight:600">${e.name}</div>
        <div style="font-size:12px; color:#888;">${e.grade} â€¢ í‹°ì–´ ${e.tier}</div>
      </div>
    `;

    // í´ë¦­ â†’ ìŠ¬ë¡¯ì— ì¥ì°©
    card.onclick = () => tryAddEnchant(e);

    box.appendChild(card);
  });
}

// ê²€ìƒ‰ ì…ë ¥ ì‹œ ìë™ ê°±ì‹ 
document.getElementById("searchEnchant").oninput = () => renderEnchantList();

// =============================================
// 5. ìŠ¬ë¡¯ì— ì¸ì±ˆíŠ¸ ì¥ì°©í•˜ê¸°
// =============================================
function tryAddEnchant(enchant) {
  // ë¹ˆ ìŠ¬ë¡¯ ì°¾ê¸°
  const emptyIndex = SLOT_DATA.findIndex(s => s === null);
  if (emptyIndex === -1) {
    alert("ìŠ¬ë¡¯ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤!");
    return;
  }

  SLOT_DATA[emptyIndex] = enchant;
  applySlotUI();
}

// =============================================
// 6. ìŠ¬ë¡¯ UI ê°±ì‹ 
// =============================================
function applySlotUI() {
  document.querySelectorAll(".slot").forEach(slot => {
    const idx = parseInt(slot.dataset.index);
    const data = SLOT_DATA[idx];

    slot.innerHTML = ""; // ì´ˆê¸°í™”
    slot.classList.remove("slot-filled");

    if (!data) {
      slot.innerHTML = "+";
      return;
    }

    // ì±„ì›Œì§„ ìŠ¬ë¡¯ UI
    slot.classList.add("slot-filled");

    const card = document.createElement("div");
    card.className = "slot-enchant";
    card.innerHTML = `
      <div style="font-weight:600; margin-bottom:4px;">${data.name}</div>
      <div style="font-size:12px; color:#555;">${data.grade} â€¢ í‹°ì–´ ${data.tier}</div>
    `;

    // ì œê±° ë²„íŠ¼ X
    const remove = document.createElement("div");
    remove.className = "remove-btn";
    remove.textContent = "Ã—";

    remove.onclick = (ev) => {
      ev.stopPropagation();
      SLOT_DATA[idx] = null;
      applySlotUI();
    };

    slot.appendChild(card);
    slot.appendChild(remove);
  });
}
</script>
<script>
// =============================================
// 7. ì €ì¥ ê¸°ëŠ¥ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
// =============================================
const SAVE_KEY = "simulator_saves_v1";
LOAD_SAVEDATA();

// =============================================
// 8. ì €ì¥ëœ ì„¸íŠ¸ ë¡œë“œ (localStorage)
// =============================================
function LOAD_SAVEDATA() {
  const raw = localStorage.getItem(SAVE_KEY);
  SAVE_SLOTS = raw ? JSON.parse(raw) : [];
  renderSaveList();
}

// =============================================
// 9. ì €ì¥ëœ ì„¸íŠ¸ ì „ì²´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
// =============================================
function renderSaveList() {
  const box = document.getElementById("saveList");
  box.innerHTML = "";

  if (SAVE_SLOTS.length === 0) {
    box.innerHTML = `<div style="text-align:center; padding:20px; color:#888;">ì €ì¥ëœ ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  SAVE_SLOTS.forEach((set, idx) => {
    const row = document.createElement("div");
    row.className = "save-row";

    row.innerHTML = `
      <div class="save-name">${set.name}</div>
      <button class="save-load-btn" data-index="${idx}">ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="save-delete-btn" data-index="${idx}">ì‚­ì œ</button>
    `;

    box.appendChild(row);
  });

  // ë¡œë“œ ì´ë²¤íŠ¸
  document.querySelectorAll(".save-load-btn").forEach(btn => {
    btn.onclick = () => loadSave(btn.dataset.index);
  });

  // ì‚­ì œ ì´ë²¤íŠ¸
  document.querySelectorAll(".save-delete-btn").forEach(btn => {
    btn.onclick = () => deleteSave(btn.dataset.index);
  });
}

// =============================================
// 10. ì €ì¥ ë²„íŠ¼ í´ë¦­
// =============================================
document.getElementById("saveButton").onclick = () => {
  const name = prompt("ì„¸íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "");

  if (!name || name.trim() === "") {
    alert("ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì €ì¥ë©ë‹ˆë‹¤.");
    return;
  }

  // í˜„ì¬ ìŠ¬ë¡¯ ìƒíƒœ ì €ì¥
  const newSet = {
    name,
    slots: SLOT_DATA.map(s => s ? { ...s } : null),
    equip: CURRENT_EQUIP
  };

  SAVE_SLOTS.push(newSet);
  localStorage.setItem(SAVE_KEY, JSON.stringify(SAVE_SLOTS));
  renderSaveList();

  alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
};

// =============================================
// 11. ì €ì¥ëœ ì„¸íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
// =============================================
function loadSave(idx) {
  const save = SAVE_SLOTS[idx];

  if (!save) return;

  SLOT_DATA = save.slots.map(s => s ? { ...s } : null);
  CURRENT_EQUIP = save.equip;

  // ì¥ë¹„ ë²„íŠ¼ ë°˜ì˜
  document.querySelectorAll(".equip-btn").forEach(b => b.classList.remove("active"));
  if (CURRENT_EQUIP) {
    const btn = document.querySelector(`.equip-btn[data-equip="${CURRENT_EQUIP}"]`);
    if (btn) btn.classList.add("active");
  }

  applySlotUI();
  renderEnchantList();

  alert("ì„¸íŠ¸ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!");
}

// =============================================
// 12. ì €ì¥ëœ ì„¸íŠ¸ ì‚­ì œ
// =============================================
function deleteSave(idx) {
  if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  SAVE_SLOTS.splice(idx, 1);
  localStorage.setItem(SAVE_KEY, JSON.stringify(SAVE_SLOTS));
  renderSaveList();
}
</script>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulator - Enchantments</title>

<link rel="icon" type="image/png" href="0001.png">

<style>
body {
  margin: 0;
  padding: 0 40px;
  background: #ffffff;
  font-family: 'Pretendard', sans-serif;
}

/* ===== ìƒë‹¨ í™ˆ ë²„íŠ¼ ===== */
.top-home {
  position: absolute;
  left: 20px;
  top: 20px;
  width: 90px;
  height: 90px;
  cursor: pointer;
}

/* ===== ì œëª© ===== */
.title {
  text-align: center;
  margin-top: 40px;
  font-size: 42px;
  font-weight: 800;
  color: #222;
}

/* ===== ì¥ë¹„ ë²„íŠ¼ ===== */
.equip-selector {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin: 25px 0;
}

.equip-btn {
  padding: 12px 22px;
  font-size: 15px;
  border-radius: 14px;
  border: 1px solid #ccc;
  background: #f7f7f7;
  cursor: pointer;
  transition: 0.15s;
}

.equip-btn:hover {
  background: #eaeaea;
}

.equip-btn.active {
  background: #2fb24a;
  color: white;
}

/* ===== ìŠ¬ë¡¯ ì˜ì—­ ===== */
.slot-box {
  width: 90%;
  margin: 25px auto;
  padding: 20px;
  border-radius: 18px;
  background: #f3fff0;
  box-shadow: 0 0 10px rgba(0,0,0,0.06);
}

.slot-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 14px;
  padding: 20px;
}

.slot {
  height: 80px;
  background: white;
  border-radius: 14px;
  border: 2px dashed #ccc;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  transition: 0.15s;
}

.slot:hover {
  border-color: #2fb24a;
}

.slot .remove-btn {
  position: absolute;
  top: 6px;
  right: 6px;
  background: #ff5c5c;
  width: 22px;
  height: 22px;
  color: white;
  font-size: 13px;
  border-radius: 4px;
  text-align: center;
  cursor: pointer;
  line-height: 22px;
}

/* ===== ì¸ì±ˆíŠ¸ ëª©ë¡ ===== */
.enchant-list {
  width: 90%;
  margin: 30px auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
}

.enchant-card {
  background: #ffffff;
  border-radius: 14px;
  border: 1px solid #ddd;
  padding: 16px;
  display: flex;
  gap: 12px;
  cursor: grab;
  transition: 0.15s;
}

.enchant-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.enchant-icon {
  width: 42px;
  height: 42px;
}

.enchant-info {
  flex: 1;
}

.enchant-name {
  font-size: 17px;
  font-weight: 700;
}

.enchant-grade {
  font-size: 13px;
  margin-top: 4px;
  display: inline-block;
  padding: 2px 8px;
  border-radius: 8px;
  font-weight: 600;
}

/* ë“±ê¸‰ìƒ‰ */
.grade-ì‹ í™” { background:#FC54FC; }
.grade-ì „ì„¤ { background:#FCA800; }
.grade-ê·¼ë³¸ { background:#FCFC54; }
.grade-íŠ¹ë³„ { background:#54FC54; }
.grade-ì—˜ë¦¬íŠ¸ { background:#54FCFC; }
.grade-ì¼ë°˜ { background:#FCFCFC; }

/* ===== ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° íŒ¨ë„ ===== */
.save-panel {
  width: 90%;
  margin: 30px auto 80px auto;
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  border: 1px solid #ddd;
}

.save-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 14px;
}

.save-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #eee;
}

.save-name {
  font-weight: 600;
}

.save-load-btn,
.save-delete-btn {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.save-load-btn { background:#2fb24a; color:white; }
.save-delete-btn { background:#ff5959; color:white; }

.save-btn-main {
  margin-top: 18px;
  padding: 12px 22px;
  background:#2fb24a;
  color:white;
  border-radius: 10px;
  cursor:pointer;
  border:none;
  font-weight:700;
}

.save-btn-main:hover {
  filter: brightness(1.1);
}

@media (max-width:800px){
  .enchant-list { grid-template-columns: repeat(2,1fr); }
}
@media (max-width:600px){
  .slot-grid { grid-template-columns: repeat(2,1fr); }
  .enchant-list { grid-template-columns: repeat(1,1fr); }
}
</style>
</head>

<body>

<!-- í™ˆ ë²„íŠ¼ -->
<a href="index.html">
  <img src="0003.png" class="top-home">
</a>

<h1 class="title">Enchant Simulator</h1>

<!-- ì¥ë¹„ ì„ íƒ -->
<div class="equip-selector">
  <button class="equip-btn" data-equip="ê²€">ê²€</button>
  <button class="equip-btn" data-equip="í™œ">í™œ</button>
  <button class="equip-btn" data-equip="ì‡ ë‡Œ">ì‡ ë‡Œ</button>
  <button class="equip-btn" data-equip="ì‚¼ì§€ì°½">ì‚¼ì§€ì°½</button>
  <button class="equip-btn" data-equip="ëª¨ì">ëª¨ì</button>
  <button class="equip-btn" data-equip="í‰ê°‘">í‰ê°‘</button>
  <button class="equip-btn" data-equip="ë°”ì§€">ë°”ì§€</button>
  <button class="equip-btn" data-equip="ì‹ ë°œ">ì‹ ë°œ</button>
  <button class="equip-btn" data-equip="ê´­ì´">ê´­ì´</button>
  <button class="equip-btn" data-equip="ì‚½">ì‚½</button>
</div>

<!-- ìŠ¬ë¡¯ ë°•ìŠ¤ -->
<div class="slot-box">
  <div class="slot-grid" id="slotGrid"></div>
</div>

<!-- ì¸ì±ˆíŠ¸ ëª©ë¡ -->
<div id="enchantList" class="enchant-list"></div>

<!-- ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° íŒ¨ë„ -->
<div class="save-panel">
  <div class="save-title">ğŸ’¾ ì €ì¥ëœ ì„¸íŠ¸ ëª©ë¡</div>
  <div id="saveList"></div>
  <button id="saveButton" class="save-btn-main">í˜„ì¬ ì„¸íŠ¸ ì €ì¥í•˜ê¸°</button>
</div>

<script>
/* ================================
   1. ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
================================ */
const SHEET_ID = "13fF_iQfMThiw49QrYSCULF3mT4QVHO4aDsbSDD71DUg";
const SHEET_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

let RAW_ENCHANTS = [];
let CURRENT_EQUIP = null;

/* ìŠ¬ë¡¯ 10ì¹¸ */
let SLOT_DATA = Array(10).fill(null);

let SAVE_SLOTS = [];

/* ===== ì‹œíŠ¸ ë¡œë“œ ===== */
fetch(SHEET_URL)
  .then(r => r.text())
  .then(txt => {
    const json = JSON.parse(txt.substr(47).slice(0, -2));
    RAW_ENCHANTS = json.table.rows.map(r => ({
      name: r.c[0]?.v ?? "",
      grade: r.c[1]?.v ?? "",
      tier: r.c[2]?.v ?? "",
      max: r.c[3]?.v ?? "",
      items: (r.c[4]?.v ?? "").split(",").map(i => i.trim())
    }));
    renderEnchantList();
  });

/* ================================
   2. ì¥ë¹„ ì„ íƒ
================================ */
document.querySelectorAll(".equip-btn").forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".equip-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    CURRENT_EQUIP = btn.dataset.equip;
    renderEnchantList();
  };
});

/* ================================
   3. ìŠ¬ë¡¯ ë Œë”ë§
================================ */
const slotGrid = document.getElementById("slotGrid");
renderSlots();

function renderSlots() {
  slotGrid.innerHTML = "";

  SLOT_DATA.forEach((slot, i) => {
    const div = document.createElement("div");
    div.className = "slot";
    div.dataset.index = i;

    if (slot) {
      div.innerHTML = `
        <div>${slot.name}</div>
        <div class="remove-btn" data-remove="${i}">X</div>
      `;
    } else {
      div.innerHTML = `<div style="color:#aaa;">+ ë¹ˆ ìŠ¬ë¡¯</div>`;
    }

    div.onclick = (ev) => {
      if (ev.target.dataset.remove !== undefined) return;
    };

    slotGrid.appendChild(div);
  });

  document.querySelectorAll(".remove-btn").forEach(btn => {
    btn.onclick = ev => {
      ev.stopPropagation();
      SLOT_DATA[btn.dataset.remove] = null;
      renderSlots();
    };
  });
}

/* ================================
   4. ì¸ì±ˆíŠ¸ ëª©ë¡ ë Œë”ë§
================================ */
function renderEnchantList() {
  const wrap = document.getElementById("enchantList");
  wrap.innerHTML = "";

  let list = [...RAW_ENCHANTS];

  if (CURRENT_EQUIP) {
    list = list.filter(e => e.items.includes(CURRENT_EQUIP));
  }

  list.forEach(e => {
    const card = document.createElement("div");
    card.className = "enchant-card";
    card.draggable = true;

    card.innerHTML = `
      <img src="0003.png" class="enchant-icon">
      <div class="enchant-info">
        <div class="enchant-name">${e.name}</div>
        <div class="enchant-grade grade-${e.grade}">${e.grade}</div>
      </div>
    `;

    card.ondragstart = ev => {
      ev.dataTransfer.setData("text/plain", e.name);
    };

    card.onclick = () => {
      for (let i = 0; i < SLOT_DATA.length; i++) {
        if (!SLOT_DATA[i]) {
          SLOT_DATA[i] = e;
          break;
        }
      }
      applySlotUI();
    };

    wrap.appendChild(card);
  });
}

/* ìŠ¬ë¡¯ ì ìš© */
function applySlotUI() {
  renderSlots();
}

/* ================================
   5. ë“œë˜ê·¸ ì•¤ ë“œë¡­
================================ */
slotGrid.ondragover = ev => ev.preventDefault();

slotGrid.ondrop = ev => {
  ev.preventDefault();
  const name = ev.dataTransfer.getData("text/plain");

  const enchant = RAW_ENCHANTS.find(e => e.name === name);
  if (!enchant) return;

  for (let i = 0; i < SLOT_DATA.length; i++) {
    if (!SLOT_DATA[i]) {
      SLOT_DATA[i] = enchant;
      break;
    }
  }
  renderSlots();
};

/* ================================
   6. ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (PART 3 ì „ì²´ íƒ‘ì¬)
================================ */
const SAVE_KEY = "simulator_saves_v1";

LOAD_SAVEDATA();

function LOAD_SAVEDATA() {
  const raw = localStorage.getItem(SAVE_KEY);
  SAVE_SLOTS = raw ? JSON.parse(raw) : [];
  renderSaveList();
}

function renderSaveList() {
  const box = document.getElementById("saveList");
  box.innerHTML = "";

  if (SAVE_SLOTS.length === 0) {
    box.innerHTML = `<div style="padding:10px; color:#aaa; text-align:center;">ì €ì¥ëœ ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  SAVE_SLOTS.forEach((set, i) => {
    const row = document.createElement("div");
    row.className = "save-row";

    row.innerHTML = `
      <div class="save-name">${set.name}</div>
      <button class="save-load-btn" data-index="${i}">ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="save-delete-btn" data-index="${i}">ì‚­ì œ</button>
    `;

    box.appendChild(row);
  });

  document.querySelectorAll(".save-load-btn").forEach(btn => {
    btn.onclick = () => loadSave(btn.dataset.index);
  });

  document.querySelectorAll(".save-delete-btn").forEach(btn => {
    btn.onclick = () => deleteSave(btn.dataset.index);
  });
}

document.getElementById("saveButton").onclick = () => {
  const name = prompt("ì„¸íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "");

  if (!name) return;

  const newSet = {
    name,
    slots: SLOT_DATA.map(s => s ? { ...s } : null),
    equip: CURRENT_EQUIP
  };

  SAVE_SLOTS.push(newSet);
  localStorage.setItem(SAVE_KEY, JSON.stringify(SAVE_SLOTS));
  renderSaveList();
};

function loadSave(i) {
  const data = SAVE_SLOTS[i];

  SLOT_DATA = data.slots.map(s => s ? { ...s } : null);
  CURRENT_EQUIP = data.equip;

  document.querySelectorAll(".equip-btn").forEach(b => b.classList.remove("active"));
  const eqBtn = document.querySelector(`.equip-btn[data-equip="${CURRENT_EQUIP}"]`);
  if (eqBtn) eqBtn.classList.add("active");

  renderSlots();
  renderEnchantList();
}

function deleteSave(i) {
  if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
  SAVE_SLOTS.splice(i, 1);
  localStorage.setItem(SAVE_KEY, JSON.stringify(SAVE_SLOTS));
  renderSaveList();
}
</script>

</body>
</html>
