<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enchantments</title>

<link rel="icon" type="image/png" href="0001.png">

<style>
body {
  margin: 0;
  padding: 0 80px;
  background: #ffffff;
  font-family: 'Pretendard', sans-serif;
}

/* ===== 작은 좌측 상단 아이콘 (Simulator 이동) ===== */
.top-icon {
  position: absolute;
  left: 20px;
  top: 20px;
  width: 64px;
  height: 64px;
  cursor: pointer;
  z-index: 9999;
}

/* ===== 메인 로고 ===== */
.logo-img {
  width: 500px;
  height: auto;
  margin: 20px auto;
  display: block;
  cursor: pointer; /* 새로고침용 */
}

/* ===== 검색 ===== */
.search-area {
  text-align: center;
  padding: 30px 0 10px;
}

#searchBar {
  width: 60%;
  max-width: 600px;
  padding: 14px 18px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 16px;
}

.search-btn {
  margin-left: 10px;
  padding: 14px 20px;
  background: #2fb24a;
  border: none;
  border-radius: 8px;
  color: white;
  font-size: 15px;
  cursor: pointer;
}

/* ===== 필터 ===== */
.filters {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.tier-btn, .item-btn, .fav-btn {
  border: none;
  padding: 8px 18px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.15s ease-in-out;
}

.tier-btn:hover, .item-btn:hover, .fav-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0px 4px 14px rgba(0,0,0,0.15);
  filter: brightness(1.1);
}

.tier-btn.active,
.item-btn.active,
.fav-btn.active {
  outline: 3px solid #000;
}

/* ===== 테이블 ===== */
.ench-table {
  width: 80%;
  margin: auto;
  border-collapse: collapse;
  border-radius: 14px;
  overflow: hidden;
  font-size: 15px;
  table-layout: fixed;
}

.ench-table th, .ench-table td {
  padding: 16px;
  border-bottom: 1px solid #f1f1f1;
  text-align: center;
}

.ench-table td:first-child {
  text-align: left;
}

.ench-table tbody tr:hover {
  background: #fafafa;
  cursor: pointer;
}

.ench-table thead {
  background: #f3fff0;
}

/* 티어 열 width */
.ench-table th:nth-child(3),
.ench-table td:nth-child(3) {
  width: 80px;
}

/* ===== 등급 배지 ===== */
.grade-badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 700;
  color: #000;
  cursor: pointer;
}

.grade-신화 { background: #FC54FC; }
.grade-전설 { background: #FCA800; }
.grade-근본 { background: #FCFC54; }
.grade-일반 { background: #FCFCFC; }
.grade-특별 { background: #54FC54; }
.grade-엘리트 { background: #54FCFC; }

/* ===== 별 아이콘 ===== */
.star {
  font-size: 24px !important;
  cursor: pointer;
  margin-right: 8px;
}

.star.off { color: #ccc; }
.star.on { color: #FFD700; }

/* ===== 아이템 칩 ===== */
.item-chip {
  display: inline-block;
  padding: 6px 12px;
  margin: 2px;
  background: #f3f3f3;
  border: 1px solid #ccc;
  border-radius: 14px;
  cursor: pointer;
  font-size: 13px;
}

.item-chip:hover {
  background: #e8e8e8;
}

/* ===== 모달 ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 99999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.35);
}

.modal-content {
  background: #fff;
  margin: 8% auto;
  padding: 30px;
  width: 50%;
  border-radius: 12px;
  box-shadow: 0px 5px 18px rgba(0,0,0,0.15);
  position: relative;
}

.close {
  float: right;
  font-size: 28px;
  cursor: pointer;
}

.modal-header {
  display: flex;
  align-items: center;
  gap: 10px;
}

.modal-star {
  font-size: 28px;
  cursor: pointer;
}
.modal-star.off { color: #ccc; }
.modal-star.on { color: #FFD700; }

.modal-item-btn {
  display: inline-block;
  padding: 6px 14px;
  margin-right: 6px;
  margin-bottom: 6px;
  border-radius: 14px;
  background: #f3f3f3;
  border: 1px solid #ccc;
  cursor: pointer;
  font-size: 13px;
}
</style>
</head>

<body>

<!-- 상단 아이콘 -->
<a href="simulator.html" class="top-icon">
  <img src="0003.png" style="width:100%; height:100%; object-fit:contain;">
</a>

<!-- 메인 로고 (새로고침) -->
<img src="0002.png" class="logo-img">

<section class="search-area">
  <input id="searchBar" placeholder="인챈트 검색 (예: 불멸, 낙뢰 ...)" />
  <button id="searchBtn" class="search-btn">검색</button>
</section>

<!-- 즐겨찾기 -->
<div class="filters">
  <button id="favToggle" class="fav-btn">
    <span id="favToggleIcon" class="star off">☆</span>
    즐겨찾기
  </button>
</div>

<!-- 등급 필터 -->
<div class="filters">
  <button class="tier-btn active" data-tier="전체">전체</button>
  <button class="tier-btn" data-tier="일반" style="background:#FCFCFC;">일반</button>
  <button class="tier-btn" data-tier="특별" style="background:#54FC54;">특별</button>
  <button class="tier-btn" data-tier="엘리트" style="background:#54FCFC;">엘리트</button>
  <button class="tier-btn" data-tier="근본" style="background:#FCFC54;">근본</button>
  <button class="tier-btn" data-tier="전설" style="background:#FCA800;">전설</button>
  <button class="tier-btn" data-tier="신화" style="background:#FC54FC;">신화</button>
</div>

<!-- 아이템 필터 -->
<div class="filters">
  <button class="item-btn active" data-item="전체">전체</button>
  <button class="item-btn" data-item="검">검</button>
  <button class="item-btn" data-item="도끼">도끼</button>
  <button class="item-btn" data-item="활">활</button>
  <button class="item-btn" data-item="쇠뇌">쇠뇌</button>
  <button class="item-btn" data-item="삼지창">삼지창</button>
  <button class="item-btn" data-item="갑옷">갑옷</button>
  <button class="item-btn" data-item="흉갑">흉갑</button>
  <button class="item-btn" data-item="바지">바지</button>
  <button class="item-btn" data-item="신발">신발</button>
  <button class="item-btn" data-item="모자">모자</button>
  <button class="item-btn" data-item="괭이">괭이</button>
  <button class="item-btn" data-item="도구">도구</button>
</div>

<!-- ===== 테이블 ===== -->
<table class="ench-table">
  <thead>
    <tr>
      <th>인챈트</th>
      <th>등급</th>
      <th>티어 <span id="tierSortBtn">↕</span></th>
      <th>최대 레벨</th>
      <th>적용 아이템</th>
    </tr>
  </thead>
  <tbody id="enchList"></tbody>
</table>

<!-- ===== 모달 ===== -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>

    <div class="modal-header">
      <span id="modalStar" class="modal-star off">☆</span>
      <h2 id="mName" style="margin:0;"></h2>
    </div>

    <div class="meta" id="mMeta"></div>
    <p class="desc" id="mEffect"></p>
    <p class="extra" id="mExtra"></p>
    <p class="items" id="mItems"></p>
  </div>
</div>

<script>
/* ===== 시트 ===== */
const SHEET_ID = "13fF_iQfMThiw49QrYSCULF3mT4QVHO4aDsbSDD71DUg";
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

let DATA = [];
let favoriteList = JSON.parse(localStorage.getItem("favorites") || "[]");
let currentTierFilter = "전체";
let currentItemFilter = "전체";
let favOnlyMode = false;
let tierSortState = 0;

/* ===== 로드 ===== */
fetch(SHEET_URL)
  .then(r=>r.text())
  .then(text=>{
    const json = JSON.parse(text.substr(47).slice(0,-2));
    const rows = json.table.rows;

    DATA = rows.map(r=>({
      name:r.c[0]?.v??"",
      grade:r.c[1]?.v??"",
      tier:r.c[2]?.v??"",
      max:r.c[3]?.v??"",
      items:(r.c[4]?.v??"").split(",").map(i=>i.trim()),
      effect:r.c[5]?.v??"",
      extra:r.c[6]?.v??""
    }));

    renderList();
  });

/* ===== 상태 ===== */
function isFav(n){ return favoriteList.includes(n); }
function toggleFav(n){
  if(isFav(n)) favoriteList = favoriteList.filter(v=>v!==n);
  else favoriteList.push(n);
  localStorage.setItem("favorites", JSON.stringify(favoriteList));
}

/* ==============================================================
      공통 렌더링 (검색/필터 공용)
============================================================== */
function renderRows(list){
  const body = document.getElementById("enchList");
  body.innerHTML = "";

  list.forEach(e=>{
    const tr = document.createElement("tr");

    const favClass = isFav(e.name) ? "on" : "off";
    const favSymbol = isFav(e.name) ? "★" : "☆";

    const itemChips = e.items
      .map(i=>`<span class="item-chip" data-item="${i}">${i}</span>`)
      .join("");

    tr.innerHTML = `
      <td style="display:flex; align-items:center; gap:10px;">
        <span class="star ${favClass}" data-name="${e.name}">${favSymbol}</span>
        <img src="0003.png" style="width:32px;height:32px;">
        <div>
          <div style="font-weight:600">${e.name}</div>
          <div style="font-size:12px;color:#888;">${e.name} 인챈트</div>
        </div>
      </td>

      <td><span class="grade-badge grade-${e.grade}" data-grade="${e.grade}">${e.grade}</span></td>
      <td>${e.tier}</td>
      <td>${e.max}</td>
      <td>${itemChips}</td>
    `;

    /* 별 클릭 */
    tr.querySelector(".star").onclick = ev => {
      ev.stopPropagation();
      toggleFav(e.name);
      renderList();
    };

    /* 등급 클릭 */
    tr.querySelector(".grade-badge").onclick = ev => {
      ev.stopPropagation();
      currentTierFilter = e.grade;
      document.querySelectorAll(".tier-btn").forEach(b=>b.classList.remove("active"));
      document.querySelector(`.tier-btn[data-tier="${e.grade}"]`).classList.add("active");
      renderList();
    };

    /* 아이템칩 */
    tr.querySelectorAll(".item-chip").forEach(chip=>{
      chip.onclick = ev=>{
        ev.stopPropagation();
        currentItemFilter = chip.dataset.item;
        document.querySelectorAll(".item-btn").forEach(b=>b.classList.remove("active"));
        document.querySelector(`.item-btn[data-item="${chip.dataset.item}"]`).classList.add("active");
        renderList();
      };
    });

    /* 행 클릭 → 모달 */
    tr.onclick = () => openModal(e);

    body.appendChild(tr);
  });
}

/* ==============================================================
      전체 렌더링 (필터 적용)
============================================================== */
function renderList(){
  let list = [...DATA];

  if(favOnlyMode) list = list.filter(e=>favoriteList.includes(e.name));
  if(currentTierFilter !== "전체") list = list.filter(e=>e.grade===currentTierFilter);
  if(currentItemFilter !== "전체") list = list.filter(e=>e.items.includes(currentItemFilter));

  if(tierSortState === 1) list.sort((a,b)=>a.tier - b.tier);
  if(tierSortState === 2) list.sort((a,b)=>b.tier - a.tier);

  renderRows(list);
}

/* ==============================================================
      검색 기능 (UI 유지)
============================================================== */
document.getElementById("searchBtn").onclick = ()=>{
  const key = document.getElementById("searchBar").value.trim();
  if(!key) return renderList();

  const filtered = DATA.filter(e=>e.name.includes(key));
  renderRows(filtered);
};

document.getElementById("searchBar").addEventListener("keyup", e=>{
  if(e.key === "Enter") document.getElementById("searchBtn").click();
});

/* ==============================================================
      모달
============================================================== */
const modal = document.getElementById("modal");

function openModal(e){
  document.getElementById("mName").textContent = e.name;
  document.getElementById("mMeta").innerHTML =
    `<span class="grade-badge grade-${e.grade}">${e.grade}</span> • 티어: ${e.tier} • 최대 레벨 ${e.max}`;

  document.getElementById("mEffect").textContent = e.effect;
  document.getElementById("mExtra").textContent = e.extra ? `추가: ${e.extra}` : "";

  const mItems = document.getElementById("mItems");
  mItems.innerHTML = "적용 아이템: ";
  e.items.forEach(item=>{
    const b = document.createElement("span");
    b.className = "modal-item-btn";
    b.textContent = item;

    b.onclick = ev=>{
      ev.stopPropagation();
      currentItemFilter = item;
      document.querySelectorAll(".item-btn").forEach(v=>v.classList.remove("active"));
      document.querySelector(`.item-btn[data-item="${item}"]`).classList.add("active");
      renderList();
    };

    mItems.appendChild(b);
  });

  const modalStar = document.getElementById("modalStar");
  modalStar.className = "modal-star " + (isFav(e.name) ? "on" : "off");
  modalStar.textContent = isFav(e.name) ? "★" : "☆";

  modalStar.onclick = ()=>{
    toggleFav(e.name);
    renderList();
    modalStar.className = "modal-star " + (isFav(e.name) ? "on" : "off");
    modalStar.textContent = isFav(e.name) ? "★" : "☆";
  };

  modal.style.display = "block";
}

document.getElementById("closeModal").onclick = ()=> modal.style.display = "none";
window.onclick = e => { if(e.target===modal) modal.style.display="none"; };

/* ==============================================================
      필터 버튼
============================================================== */
document.querySelectorAll(".tier-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".tier-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentTierFilter = btn.dataset.tier;
    renderList();
  };
});

document.querySelectorAll(".item-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".item-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentItemFilter = btn.dataset.item;
    renderList();
  };
});

/* 즐겨찾기 토글 */
document.getElementById("favToggle").onclick = ()=>{
  favOnlyMode = !favOnlyMode;
  const icon = document.getElementById("favToggleIcon");
  icon.textContent = favOnlyMode ? "★" : "☆";
  icon.className = "star " + (favOnlyMode ? "on" : "off");
  document.getElementById("favToggle").classList.toggle("active");
  renderList();
};

/* 티어 정렬 */
document.getElementById("tierSortBtn").onclick = ()=>{
  tierSortState = (tierSortState + 1) % 3;
  renderList();
};

/* 메인 로고 새로고침 */
document.querySelector(".logo-img").onclick = () => location.reload();
</script>

</body>
</html>
