<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enchantments</title>

<link rel="icon" type="image/png" href="0001.png">

<style>
body {
  margin: 0;
  padding: 0 80px;
  background: #ffffff;
  font-family: 'Pretendard', sans-serif;
}

/* 로고 */
.logo-img {
  width: 500px;
  height: auto;
  margin: 20px auto 20px auto;
  display: block;
}

/* 검색 */
.search-area {
  text-align: center;
  padding: 30px 0 10px;
}

#searchBar {
  width: 60%;
  max-width: 600px;
  padding: 14px 18px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 16px;
}

.search-btn {
  margin-left: 10px;
  padding: 14px 20px;
  background: #2fb24a;
  border: none;
  border-radius: 8px;
  color: white;
  font-size: 15px;
  cursor: pointer;
}

/* 필터 */
.filters {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.tier-btn, .item-btn {
  border: none;
  padding: 8px 18px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.15s ease-in-out;
}

.tier-btn:hover, .item-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0px 4px 14px rgba(0,0,0,0.15);
  filter: brightness(1.1);
}

.item-btn.active {
  outline: 3px solid #2fb24a;
}

/* 테이블 */
.ench-table {
  width: 80%;
  margin: auto;
  border-collapse: collapse;
  border-radius: 14px;
  overflow: hidden;
  font-size: 15px;
  table-layout: fixed;
}

.ench-table th, .ench-table td {
  padding: 16px;
  border-bottom: 1px solid #f1f1f1;
  text-align: center;
}

.ench-table td:first-child {
  text-align: left;
}

.ench-table tbody tr:hover {
  background: #fafafa;
  cursor: pointer;
}

.ench-table thead {
  background: #f3fff0;
}

/* 모달 */
.modal {
  display: none;
  position: fixed;
  z-index: 99999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.35);
}

.modal-content {
  background: #fff;
  margin: 8% auto;
  padding: 30px;
  width: 50%;
  border-radius: 12px;
  box-shadow: 0px 5px 18px rgba(0,0,0,0.15);
}

.close {
  float: right;
  font-size: 28px;
  cursor: pointer;
}

.meta {
  color: #666;
  margin-bottom: 15px;
  font-weight: 600;
}

.desc {
  font-size: 17px;
  line-height: 1.7;
  color: #333;
}

.extra {
  font-size: 14px;
  margin-top: 10px;
  color: #444;
  font-weight: 500;
}

.items {
  font-size: 13px;
  margin-top: 10px;
  color: #777;
}

/* 티어 색상 (op.gg 스타일) */
.tier-badge {
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 700;
  display: inline-block;
  color: #fff;
}

.tier-op { background: #FF4555; }
.tier-1 { background: #1A8CFF; }
.tier-2 { background: #00C8A4; }
.tier-3 { background: #E6A93A; }
.tier-4 { background: #9EA3AD; }
.tier-5 { background: #8A5A3B; }

</style>
</head>
<body>

<!-- 로고 -->
<img src="0002.png" class="logo-img">

<!-- 검색 -->
<section class="search-area">
  <input id="searchBar" placeholder="인챈트 검색 (예: 불멸, 낙뢰, 수확 ...)" />
  <button id="searchBtn" class="search-btn">검색</button>
</section>

<!-- 등급 필터 -->
<div class="filters">
  <button class="tier-btn" data-tier="OP" style="background:#FF4555; color:white;">OP</button>
  <button class="tier-btn" data-tier="1티어" style="background:#1A8CFF; color:white;">1티어</button>
  <button class="tier-btn" data-tier="2티어" style="background:#00C8A4; color:white;">2티어</button>
  <button class="tier-btn" data-tier="3티어" style="background:#E6A93A; color:white;">3티어</button>
  <button class="tier-btn" data-tier="4티어" style="background:#9EA3AD; color:white;">4티어</button>
  <button class="tier-btn" data-tier="5티어" style="background:#8A5A3B; color:white;">5티어</button>
  <button class="tier-btn" data-tier="전체">전체보기</button>
</div>

<!-- 아이템 필터 -->
<div class="filters">
  <button class="item-btn active" data-item="전체">전체</button>
  <button class="item-btn" data-item="검">검</button>
  <button class="item-btn" data-item="도끼">도끼</button>
  <button class="item-btn" data-item="활">활</button>
  <button class="item-btn" data-item="쇠뇌">쇠뇌</button>
  <button class="item-btn" data-item="삼지창">삼지창</button>
  <button class="item-btn" data-item="흉갑">흉갑</button>
  <button class="item-btn" data-item="갑옷">갑옷</button>
  <button class="item-btn" data-item="바지">바지</button>
  <button class="item-btn" data-item="신발">신발</button>
  <button class="item-btn" data-item="모자">모자</button>
  <button class="item-btn" data-item="낫">낫</button>
  <button class="item-btn" data-item="도구">도구</button>
</div>

<table class="ench-table">
  <thead>
    <tr>
      <th>인챈트</th>
      <th>티어</th>
      <th>등급</th>
      <th>최대 레벨</th>
      <th>적용 아이템</th>
    </tr>
  </thead>
  <tbody id="enchList"></tbody>
</table>

<!-- 모달 -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>

    <h2 id="mName"></h2>
    <div id="mMeta" class="meta"></div>
    <p id="mEffect" class="desc"></p>
    <p id="mExtra" class="extra"></p>
    <p id="mItems" class="items"></p>
  </div>
</div>

<script>
const SHEET_ID = "13fF_iQfMThiw49QrYSCULF3mT4QVHO4aDsbSDD71DUg";
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

let DATA = [];
let currentTierFilter = "전체";
let currentItemFilter = "전체";

// 1) 시트 로드
fetch(SHEET_URL)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    DATA = rows.map(r => ({
      name: r.c[0]?.v || "",
      tier: r.c[1]?.v || "",
      grade: r.c[2]?.v || "",
      max: r.c[3]?.v || "",
      items: r.c[4]?.v?.split(",").map(i => i.trim()) || [],
      effect: r.c[5]?.v || "",
      extra: r.c[6]?.v || ""
    }));

    renderList(DATA);
  });

// 티어 → CSS 클래스
function tierClass(tier) {
  if (tier === "OP") return "tier-op";
  if (tier === "1티어") return "tier-1";
  if (tier === "2티어") return "tier-2";
  if (tier === "3티어") return "tier-3";
  if (tier === "4티어") return "tier-4";
  if (tier === "5티어") return "tier-5";
  return "";
}

// 2) 리스트 렌더링
function renderList(list) {
  const body = document.getElementById("enchList");
  body.innerHTML = "";

  let filtered = list;

  if (currentTierFilter !== "전체")
    filtered = filtered.filter(e => e.tier === currentTierFilter);

  if (currentItemFilter !== "전체")
    filtered = filtered.filter(e => e.items.includes(currentItemFilter));

  filtered.forEach(e => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td style="display:flex; align-items:center; gap:10px;">
        <img src="0003.png" style="width:32px; height:32px;">
        <div>
          <div style="font-weight:600">${e.name}</div>
          <div style="font-size:12px; color:#888;">${e.name} 인챈트</div>
        </div>
      </td>

      <td>
        <span class="tier-badge ${tierClass(e.tier)}">${e.tier}</span>
      </td>

      <td>${e.grade}</td>
      <td>${e.max}</td>
      <td>${e.items.join(", ")}</td>
    `;

    tr.onclick = () => openModal(e);
    body.appendChild(tr);
  });
}

// 3) 모달
function openModal(e) {
  document.getElementById("mName").textContent = e.name;

  document.getElementById("mMeta").innerHTML =
    `<span class="tier-badge ${tierClass(e.tier)}">${e.tier}</span>
     • 등급: ${e.grade}
     • 최대 레벨 ${e.max}`;

  document.getElementById("mEffect").textContent = e.effect;
  document.getElementById("mExtra").textContent =
    e.extra ? `추가 설명: ${e.extra}` : "";
  document.getElementById("mItems").textContent =
    `적용 아이템: ${e.items.join(", ")}`;

  document.getElementById("modal").style.display = "block";
}

document.getElementById("closeModal").onclick =
  () => document.getElementById("modal").style.display = "none";

window.onclick = e => {
  if (e.target === document.getElementById("modal"))
    document.getElementById("modal").style.display = "none";
};

// 4) 검색
document.getElementById("searchBtn").onclick = () => {
  const key = document.getElementById("searchBar").value.trim();
  renderList(DATA.filter(e => e.name.includes(key)));
};

document.getElementById("searchBar").addEventListener("keyup", e => {
  if (e.key === "Enter") document.getElementById("searchBtn").click();
});

// 5) 등급 필터
document.querySelectorAll(".tier-btn").forEach(btn => {
  btn.onclick = () => {
    currentTierFilter = btn.dataset.tier;
    renderList(DATA);
  };
});

// 6) 아이템 필터
document.querySelectorAll(".item-btn").forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".item-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    currentItemFilter = btn.dataset.item;
    renderList(DATA);
  };
});
</script>

</body>
</html>
